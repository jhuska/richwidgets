// JBoss RedHat (c)
(function(e){e.widget("rf.orderingList",{options:{disabled:!1,header:"",showButtons:!0,mouseOrderable:!0,widgetEventPrefix:"orderingList_",dropOnEmpty:!0,dragSelect:!1},_create:function(){var t=this;this.selectableOptions={disabled:t.options.disabled,create:function(s){e(s.target).find(".ui-selectee").addClass(t.options.selecteeClass)},selecting:function(s,i){e(i.selecting).addClass(t.options.selectedClass)},unselecting:function(s,i){t.options.selectedClass&&e(i.unselecting).removeClass(t.options.selectedClass)}},this.sortableOptions={handle:this.options.dragSelect?".handle":!1,disabled:this.options.disabled,dropOnEmpty:this.options.dropOnEmpty,scroll:!0,placeholder:"placeholder "+(this.options.placeholderStyleClass||""),tolerance:"pointer",start:function(e,s){t.currentItems=s.item.parent().children(".ui-selected").not(".placeholder").not(".helper-item");var i=s.helper,n=t.element.find(".placeholder");n.css("height",i.css("height")),t.currentItems.not(s.item).hide()},sort:function(t,s){var i=e(this),n=s.helper.position().top,o=n+s.helper.outerHeight();i.children(".ui-selectee").not(".placeholder").not(".helper-item").not(".ui-selected").each(function(){var t=e(this),s=t.position().top,l=t.position().top+t.outerHeight()/2;return l>n&&o>l?(s>n?e(".placeholder",i).insertAfter(t):e(".placeholder",i).insertBefore(t),!1):void 0})},cancel:function(){t.currentItems.show()},receive:function(e,s){s.item.after(s.sender.find(".ui-selected"));var i=t._dumpState();i.originalEvent=e,t._trigger("receive",e,i)},beforeStop:function(){},stop:function(e,s){var i=t.currentItems.first();i.get(0)!==s.item.get(0)?(s.item.before(i),i.after(t.currentItems.not(i).detach())):s.item.after(t.currentItems.not(s.item).detach()),t.currentItems.not(".placeholder").show();var s=t._dumpState();s.movement="drag",t._trigger("change",e,s)}},"false"!=this.options.contained&&(this.sortableOptions.containment=this.element,this.sortableOptions.axis="y"),this.element.is("table")?(this.strategy="table",this.$pluginRoot=e(this.element).find("tbody"),this.selectableOptions.filter="tr",this.sortableOptions.helper=e.proxy(this._rowHelper,this)):(this.strategy="list",this.$pluginRoot=e(this.element),this.selectableOptions.filter="li",this.sortableOptions.helper=e.proxy(this._listHelper,this)),this.options.mouseOrderable!==!0&&(this.options.showButtons=!0),this._addDomElements(),this.widgetEventPrefix=this.options.widgetEventPrefix,this.options.mouseOrderable===!0&&this.$pluginRoot.sortable(this.sortableOptions),this.$pluginRoot.selectable(this.selectableOptions),this.options.disabled===!0&&t._disable(),0==this.options.dragSelect?(this.element.on("mousedown",".ui-selectee",function(){var t=e(this),s=t.parents(".list").first();s.data("rfOrderingList").mouseStarted=!0}),this.$pluginRoot.on("mousemove",".ui-selectee",function(t){var s=e(this),i=s.parents(".list").first(),n=i.data("rfOrderingList");if(n.mouseStarted&&(n.mouseStarted=!1,!s.hasClass("ui-selected"))){var o=n.$pluginRoot.data("uiSelectable");o._mouseStart(t),o._mouseStop(t)}}),this.element.on("mouseup",".ui-selectee",function(t){var s=e(this),i=s.parents(".list").first(),n=i.data("rfOrderingList");if(n.mouseStarted){n.mouseStarted=!1;var o=n.$pluginRoot.data("uiSelectable");o._mouseStart(t),o._mouseStop(t)}})):this.element.find(".handle").on("mousedown",function(t){var s=e(this).parents(".ui-selectee").first();if(!s.hasClass("ui-selected")){var i=s.parents(".list").first();i.data("rfOrderingList").$pluginRoot.data("uiSelectable"),i.data("uiSelectable")._mouseStart(t),i.data("uiSelectable")._mouseStop(t)}})},destroy:function(){return e.Widget.prototype.destroy.call(this),this._removeDomElements(),this.$pluginRoot.sortable("destroy").selectable("destroy"),this},_listHelper:function(t,s){var i=e("<ol />").addClass("helper "+(this.options.helperStyleClass||"")).css("height","auto").css("width",this.element.css("width"));return s.parent().children(".ui-selected").not(".ui-sortable-placeholder").clone().addClass("helper-item").show().appendTo(i),i},_rowHelper:function(t,s){var i=e("<tbody />").addClass("helper "+this.options.helperStyleClass).css("height","auto");s.parent().children(".ui-selected").not(".ui-sortable-placeholder").clone().addClass("helper-item").show().appendTo(i);var n=i.children("tr").first();return n.children().each(function(t){var i=s.children().get(t),n=e(i).css("width");e(this).css("width",n)}),i},_setOption:function(t,s){var i=this;if(this.options.key!==s){switch(t){case"disabled":s===!0?i._disable():i._enable()}e.Widget.prototype._setOption.apply(i,arguments)}},isSelected:function(t){return e(t).hasClass("ui-selected")},selectItem:function(t){e(t).addClass("ui-selected "+this.options.selectedClass)},unSelectItem:function(t){e(t).removeClass("ui-selected "+this.options.selectedClass)},unSelectAll:function(){var e=this;this._removeDomElements(),this.element.children().each(function(){e.unSelectItem(this)})},moveTop:function(t,s){if(!this.options.disabled){var i=t.prevAll().not(".ui-selected").last();e(t).insertBefore(i);var n=this._dumpState();n.movement="moveTop",this._trigger("change",s,n)}},moveUp:function(t,s){if(!this.options.disabled){e(t).each(function(){var t=e(this),s=t.prevAll().not(".ui-selected").first();s.length>0&&t.insertBefore(s)});var i=this._dumpState();i.movement="moveUp",this._trigger("change",s,i)}},moveDown:function(t,s){if(!this.options.disabled){e(t).sort(function(){return 1}).each(function(){var t=e(this),s=t.nextAll().not(".ui-selected").first();s.length>0&&t.insertAfter(s)});var i=this._dumpState();i.movement="moveDown",this._trigger("change",s,i)}},moveLast:function(t,s){if(!this.options.disabled){var i=t.nextAll().not(".ui-selected").last();e(t).insertAfter(i);var n=this._dumpState();n.movement="moveLast",this._trigger("change",s,n)}},getOrderedElements:function(){return this.element.find(".ui-selectee")},getOrderedKeys:function(){var t=[];return this.getOrderedElements().each(function(){var s=e(this),i=s.data("key"),n=i?i:s.text();t.push(n)}),t},_addDomElements:function(){this._addParents(),this._addMouseHandles(),this.options.showButtons===!0&&this._addButtons(),"table"===this.strategy&&e(this.element).find("tr").each(function(){e(this).children().last().addClass("last"),e(this).children().first().addClass("first")})},_addButtons:function(){var t=e("<button/>").attr("type","button").addClass("btn"),s=e("<div/>").addClass("btn-group-vertical").addClass(this.options.buttonsStyleClass);s.append(t.clone().addClass("first").html("<i class='icon-arrow-up'></i>").bind("click.orderingList",e.proxy(this._topHandler,this))).append(t.clone().addClass("up").html("<i class='icon-arrow-up'></i>").bind("click.orderingList",e.proxy(this._upHandler,this))).append(t.clone().addClass("down").html("<i class='icon-arrow-down'></i>").bind("click.orderingList",e.proxy(this._downHandler,this))).append(t.clone().addClass("last").html("<i class='icon-arrow-down'></i>").bind("click.orderingList",e.proxy(this._lastHandler,this))),this.content.append(e("<div />").addClass("buttonColumn").append(s))},_addMouseHandles:function(){this.options.mouseOrderable===!0&&(this.options.dragSelect===!0?(this.content.addClass("with-handle"),"table"===this.strategy?(e(this.element).find("tbody > tr").prepend("<th class='handleCell'><div class='handle'><i class='icon-move'></i></div></th>"),e(this.element).find("thead > tr").prepend("<th class='handleCell'></th>")):"list"===this.strategy&&e(this.element).find("li").prepend("<div class='handle'><i class='icon-move'></i></div>")):"table"===this.strategy&&(e(this.element).find("tbody > tr").prepend("<th class='emptyCell'></th>"),e(this.element).find("thead > tr").prepend("<th class='emptyCell'></th>")))},_addParents:function(){this.element.addClass("list").wrap(e("<div />").addClass("orderingList outer").append(e("<div />").addClass("content").append(e("<div />").addClass("listBox")))),this.outer=this.element.parents(".outer").first();var t=e("<div />").addClass("header");this.options.header&&t.append(e("<h3/>").html(this.options.header)).addClass(this.options.headerClass),this.outer.prepend(t),this.content=this.outer.find(".content"),this.options.dimensions&&this.element.css(this.options.dimensions)},_disable:function(){this.$pluginRoot.sortable("option","disabled",!0).selectable("option","disabled",!0),this.element.addClass("disabled  "+this.options.disabledClass).find(".ui-selected").removeClass("ui-selected"),e(".buttonColumn",this.content).find("button").attr("disabled",!0)},_enable:function(){this.$pluginRoot.sortable("option","disabled",!1).selectable("option","disabled",!1),this.element.removeClass("disabled"),this.options.disabledClass&&this.element.removeClass(this.options.disabledClass),e(".buttonColumn",this.content).find("button").attr("disabled",!1)},_dumpState:function(){var e={};return e.orderedElements=this.getOrderedElements(),e.orderedKeys=this.getOrderedKeys(),e},_removeDomElements:function(){var e=this.element.detach();this.outer.replaceWith(e)},_topHandler:function(t){this.moveTop(e(".ui-selected",this.element),t)},_upHandler:function(t){this.moveUp(e(".ui-selected",this.element),t)},_downHandler:function(t){this.moveDown(e(".ui-selected",this.element),t)},_lastHandler:function(t){this.moveLast(e(".ui-selected",this.element),t)}})})(jQuery);